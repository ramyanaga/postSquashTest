This is Dan commit 4.5 Should go on top of giant squash. 